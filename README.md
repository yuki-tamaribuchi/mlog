# mlog (読み：エムログ)

音楽コンテンツ専用ブログサービス。

曲に対して思ったことを共有することができます。

[http://mlog.tamaribuchi-yuki.com/login_with_sample_user/](http://mlog.tamaribuchi-yuki.com/login_with_sample_user/) 

上記URLはサンプルユーザで自動ログインされるようにしています。

- サンプルユーザのユーザネームとパスワードはこちらです。

    ユーザネーム: sampleuser

    パスワード: passw0rd

<br><br>

# 使用技術

## 言語・フレームワーク

- Python 3.9.7
- Django 3.2.4

## ミドルウェア

### RDB

- MariaDB 5.1(開発環境)
- MySQL 8.0.23(本番環境)

### Webサーバ

- Nginx

### NoSQL

- Redis

## インフラストラクチャ

### AWS

- VPC
- EC2
- RDS
- Route53
- SES
- S3
- Cloudfront
- ECR
- ECS・Fargate (ほとんど触っていない)
- Cloudformation (少し変更を加えた)

## コンテナ技術

- Docker 20.10.8
- docker-compose 1.29.2
- docker compose

## VCS

- git
- GitHub

## その他使用技術

- ajax
- Circle CI
- django-select2(セレクトボックスに検索機能を追加するため)
- Celery(非同期タスク処理用)
- Spotify API
  
<br><br>

# 主要機能

- 新規登録 / ログイン / ログアウト / パスワード変更 / パスワードリセット / アカウント削除
- 記事投稿・閲覧・編集・削除
- ジャンル、アーティスト、曲の情報を登録、編集
- 記事と曲の関連付け
- タイムライン機能

<br>

# その他機能

## ユーザアカウント関連

- ユーザプロフィール登録・編集
- プロフィール写真登録・変更
- フォロー機能

## 記事関連

- ページネーション
- 記事へのコメント投稿・一覧表示・編集・削除
- 記事へのライクを付ける機能、ライクを解除する機能

## 音楽コンテンツ関連

- 曲・アーティスト詳細ページ
- お気に入りアーティスト登録・解除
- Spotify APIを用いたSpotifyリンクURL取得・アートワーク取得・30秒プレビュー音源URL取得機能

## 全体

- 検索機能(アーティスト・曲・ユーザ)
- お問い合わせ
- 通知機能(記事へのライク・フォロー等)
- i18n(日本語と英語、一部)

## 裏側の機能

### 非同期処理


- 通知データのDB登録処理
- 通知の既読ステータス更新のDB登録処理
- アクティビティデータのDB登録処理

### ajax

- Spotify APIで曲を検索する際の検索結果ページの作成
- 記事へのライクのリクエストと成功時のボタン表示変更
- ユーザのフォローのリクエストと成功時のボタン表示変更
- お気に入りアーティスト登録リクエストと成功時のボタン表示変更

### DBトランザクション機能

- お問い合わせスレッド作成時に、スレッドと内容を同時に登録する必要があったため

### Content-Security-Policyによるセキュリティ強化

- script-srcやimg-srcなどに対するドメインによる制限

### ユーザのアクティビティ記録

- どのユーザのページ・どのアーティストのページを閲覧したかなど

<br><br>

# テスト

## ユニットテスト

### urls

- 任意のurlにアクセスした時に意図したviewクラスが呼び出されるか

### views

- 任意のviewクラスにアクセスした時に意図したテンプレートが使用されているか
- 任意のviewクラスのレスポンスに意図したコンテクストが含まれているか

### models

- 任意のmodelのフィールドの最大字数が意図した字数になっているか
- インスタンスのstrメソッドの戻り値が意図したものになっているか

<br><br>

# 制作について

## 製作期間

2021年6月14日から現在

## 途中経過

2021年6月27日: アプリが一枚岩化していたため分離作業

2021年7月8日: docker / docker-compose導入

2021年7月18日: CircleCI導入

2021年8月6日: CSP設定

2021年8月22日: N+1問題対策

2021年8月31日: i18n対応開始

2021年9月6日: AWS ECSへのデプロイ環境構築開始

2021年9月7日: AWS S3対応

2021年9月8日: AWS SES対応

2021年9月11日: AWS RDS対応

2021年9月14日: AWS ECS fargateへのデプロイ環境構築完了

<br><br>

# 各アプリの役割

accounts: ユーザアカウント管理

activity: ユーザアクティビティ管理

comments: コメント管理

contact: お問い合わせ管理

entry: 記事管理

favorite_artists: お気に入りアーティスト管理

follow: フォロー管理

likes: ライク管理

musics: ジャンル・アーティスト・曲管理

search: 検索機能